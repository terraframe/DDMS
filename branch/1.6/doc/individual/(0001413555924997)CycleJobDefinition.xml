<version xsi:noNamespaceSchemaLocation="../../profiles/version_gis.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <doIt>
    <create>
      <mdBusiness name="dss.vector.solutions.query.CycleJob" label="Cycle job" extends="com.runwaysdk.system.scheduler.ExecutableJob" generateController="true">
        <attributes>
          <char name="jobName" label="Job name" required="true" indexType="unique index" size="255" />
          <reference name="savedMap" label="Saved map" required="true" type="dss.vector.solutions.query.SavedMap" indexType="unique index" />
          <char name="layerId" label="Layer" required="true" size="64" description="Semantic layer id" />
        </attributes>
      </mdBusiness>
      <mdView name="dss.vector.solutions.query.CycleJobView" label="Cycle job">
        <attributes>
          <char name="concreteId" label="Concrete id" required="true" size="64" />
          <boolean name="createJob" label="Create cycle job" required="true" defaultValue="false" negativeLabel="False" positiveLabel="True" />
          <virtual concrete="jobName" type="dss.vector.solutions.query.CycleJob" />
          <virtual concrete="savedMap" type="dss.vector.solutions.query.CycleJob" />
          <virtual concrete="layerId" type="dss.vector.solutions.query.CycleJob" />
        </attributes>
      </mdView>
      <mdBusiness name="dss.vector.solutions.query.GeneratedMap" label="Generated map" generateController="false">
        <attributes>
          <blob name="mapImage" label="Map image" />
          <reference name="savedMap" label="Saved map" type="dss.vector.solutions.query.SavedMap" required="true" />
          <char name="cycleLayerName" label="Cycle layer name" size="255" required="true" />
          <char name="cycleUniversal" label="Cycle universal name" size="255" required="true" />
          <char name="filterGeoEntityName" label="Filter geo entity name" size="255" required="true" />
          <char name="filterGeoId" label="Filter geo entity ID" size="255" required="true" />
          <reference name="disease" label="Disease" type="dss.vector.solutions.general.Disease" required="true" />
        </attributes>
      </mdBusiness>
      <mdException name="dss.vector.solutions.query.UnknownLayerException" label="Unknown layer exception" message="A layer with the id of [{layerId}] on map [{mapName}] does not exist.">
        <attributes>
          <text name="layerId" label="Layer id" />
          <text name="mapName" label="Map name" />
        </attributes>
      </mdException>
      <mdException name="dss.vector.solutions.query.MapInUseException" label="Map in use exception" message="The map cannot be saved because it is currently in use by an active cycle job." />      
    </create>
    <update>
      <mdController name="dss.vector.solutions.query.CycleJobController">
        <create>
          <mdAction name="getJobForMap" isPost="false" label="Get job for map" isQuery="false">
            <mdParameter name="mapId" label="Map id" order="0" type="java.lang.String" />
          </mdAction>
          <mdAction name="save" isPost="true" label="Save" isQuery="false">
            <mdParameter name="view" label="View" order="0" type="dss.vector.solutions.query.CycleJobView" />
          </mdAction>
        </create>
      </mdController>
      <mdBusiness name="dss.vector.solutions.query.Layer">
        <create>
          <attributes>
            <char name="semanticId" label="Semantic id" required="true" size="64" />
          </attributes>
          <mdMethod name="isUsedForCycleJob" label="Is used for cycle job" static="false" returnType="java.lang.Boolean" />
        </create>
      </mdBusiness>
      <mdBusiness name="dss.vector.solutions.query.SavedMap">
        <mdMethod name="deleteLayerFromMap" returnType="java.lang.String" />
        <create>
          <mdMethod name="getCycleJobView" label="Get cycle job view" static="false" returnType="dss.vector.solutions.query.CycleJobView" />
        </create>
      </mdBusiness>
    </update>
  </doIt>
  <undoIt>
    <delete>
      <object key="dss.vector.solutions.query.MapInUseException" type="com.runwaysdk.system.metadata.MdException"/>    
      <object key="dss.vector.solutions.query.GeneratedMap" type="com.runwaysdk.system.metadata.MdBusiness" />    
      <object key="dss.vector.solutions.query.CycleJobController.save" type="com.runwaysdk.system.metadata.MdAction" />
      <object key="dss.vector.solutions.query.CycleJobController.getJobForMap" type="com.runwaysdk.system.metadata.MdAction" />
      <object key="dss.vector.solutions.query.SavedMap.getCycleJobView" type="com.runwaysdk.system.metadata.MdMethod" />
      <object key="dss.vector.solutions.query.Layer.isUsedForCycleJob" type="com.runwaysdk.system.metadata.MdMethod" />
      <object key="dss.vector.solutions.query.Layer.semanticId" type="com.runwaysdk.system.metadata.MdAttribute" />
      <object key="dss.vector.solutions.query.UnknownLayerException" type="com.runwaysdk.system.metadata.MdException" />
      <object key="dss.vector.solutions.query.CycleJobView" type="com.runwaysdk.system.metadata.MdView" />
      <object key="dss.vector.solutions.query.CycleJob" type="com.runwaysdk.system.metadata.MdBusiness" />
    </delete>
  </undoIt>
</version>