
(function(){var Dom=YAHOO.util.Dom,Lang=YAHOO.lang,CLASS_PROGBAR='yui-pb',CLASS_MASK=CLASS_PROGBAR+'-mask',CLASS_BAR=CLASS_PROGBAR+'-bar',CLASS_ANIM=CLASS_PROGBAR+'-anim',CLASS_TL=CLASS_PROGBAR+'-tl',CLASS_TR=CLASS_PROGBAR+'-tr',CLASS_BL=CLASS_PROGBAR+'-bl',CLASS_BR=CLASS_PROGBAR+'-br',WIDTH='width',HEIGHT='height',MIN_VALUE='minValue',MAX_VALUE='maxValue',VALUE='value',ANIM='anim',DIRECTION='direction',DIRECTION_LTR='ltr',DIRECTION_RTL='rtl',DIRECTION_TTB='ttb',DIRECTION_BTT='btt',BAR_EL='barEl',MASK_EL='maskEl',ARIA_TEXT_TEMPLATE='ariaTextTemplate',START='start',PROGRESS='progress',COMPLETE='complete';var Prog=function(oConfigs){YAHOO.log('Creating ProgressBar instance','info','ProgressBar');Prog.superclass.constructor.call(this,document.createElement('div'),oConfigs);this._init(oConfigs);};YAHOO.widget.ProgressBar=Prog;Prog.MARKUP=['<div class="',CLASS_BAR,'"></div><div class="',CLASS_MASK,'"><div class="',CLASS_TL,'"></div><div class="',CLASS_TR,'"></div><div class="',CLASS_BL,'"></div><div class="',CLASS_BR,'"></div></div>'].join('');Lang.extend(Prog,YAHOO.util.Element,{_init:function(oConfigs){},initAttributes:function(oConfigs){YAHOO.log('Initializing configuration attributes','info','ProgressBar');Prog.superclass.initAttributes.call(this,oConfigs);this.set('innerHTML',Prog.MARKUP);this.addClass(CLASS_PROGBAR);var key,presets=['id',WIDTH,HEIGHT,'class','style'];while((key=presets.pop())){if(key in oConfigs){this.set(key,oConfigs[key]);}}
this.setAttributeConfig(BAR_EL,{readOnly:true,value:this.getElementsByClassName(CLASS_BAR)[0]});this.setAttributeConfig(MASK_EL,{readOnly:true,value:this.getElementsByClassName(CLASS_MASK)[0]});this.setAttributeConfig(DIRECTION,{value:DIRECTION_LTR,validator:function(value){if(this._rendered){return false;}
switch(value){case DIRECTION_LTR:case DIRECTION_RTL:case DIRECTION_TTB:case DIRECTION_BTT:return true;default:return false;}},method:function(value){this._barSizeFunction=this._barSizeFunctions[this.get(ANIM)?1:0][value];}});this.setAttributeConfig(MAX_VALUE,{value:100,validator:Lang.isNumber,method:function(value){this.get('element').setAttribute('aria-valuemax',value);if(this.get(VALUE)>value){this.set(VALUE,value);}}});this.setAttributeConfig(MIN_VALUE,{value:0,validator:Lang.isNumber,method:function(value){this.get('element').setAttribute('aria-valuemin',value);if(this.get(VALUE)<value){this.set(VALUE,value);}}});this.setAttributeConfig(WIDTH,{getter:function(){return this.getStyle(WIDTH);},method:this._widthChange});this.setAttributeConfig(HEIGHT,{getter:function(){return this.getStyle(HEIGHT);},method:this._heightChange});this.setAttributeConfig(ARIA_TEXT_TEMPLATE,{value:'{value}'});this.setAttributeConfig(VALUE,{value:0,validator:function(value){return Lang.isNumber(value)&&value>=this.get(MIN_VALUE)&&value<=this.get(MAX_VALUE);},method:this._valueChange});this.setAttributeConfig(ANIM,{validator:function(value){return!!YAHOO.util.Anim;},setter:this._animSetter});},render:function(parent,before){YAHOO.log('start render','info','ProgressBar');if(this._rendered){return;}
this._rendered=true;var direction=this.get(DIRECTION);this.addClass(CLASS_PROGBAR);this.addClass(CLASS_PROGBAR+'-'+direction);var container=this.get('element');container.tabIndex=0;container.setAttribute('role','progressbar');container.setAttribute('aria-valuemin',this.get(MIN_VALUE));container.setAttribute('aria-valuemax',this.get(MAX_VALUE));this.appendTo(parent,before);this._barSizeFunction=this._barSizeFunctions[0][direction];this.redraw();this._previousValue=this.get(VALUE);this._fixEdges();if(this.get(ANIM)){this._barSizeFunction=this._barSizeFunctions[1][direction];}
this.on('minValueChange',this.redraw);this.on('maxValueChange',this.redraw);return this;},redraw:function(){YAHOO.log('Redraw','info','ProgressBar');this._recalculateConstants();this._valueChange(this.get(VALUE));},destroy:function(){YAHOO.log('destroy','info','ProgressBar');this.set(ANIM,false);this.unsubscribeAll();var el=this.get('element');if(el.parentNode){el.parentNode.removeChild(el);}},_previousValue:0,_barSpace:100,_barFactor:1,_rendered:false,_barSizeFunction:null,_heightChange:function(value){if(Lang.isNumber(value)){value+='px';}
this.setStyle(HEIGHT,value);this._fixEdges();this.redraw();},_widthChange:function(value){if(Lang.isNumber(value)){value+='px';}
this.setStyle(WIDTH,value);this._fixEdges();this.redraw();},_fixEdges:function(){if(!this._rendered||YAHOO.env.ua.ie||YAHOO.env.ua.gecko){return;}
var maskEl=this.get(MASK_EL),tlEl=Dom.getElementsByClassName(CLASS_TL,undefined,maskEl)[0],trEl=Dom.getElementsByClassName(CLASS_TR,undefined,maskEl)[0],blEl=Dom.getElementsByClassName(CLASS_BL,undefined,maskEl)[0],brEl=Dom.getElementsByClassName(CLASS_BR,undefined,maskEl)[0],newSize=(parseInt(Dom.getStyle(maskEl,HEIGHT),10)-
parseInt(Dom.getStyle(tlEl,HEIGHT),10))+'px';Dom.setStyle(blEl,HEIGHT,newSize);Dom.setStyle(brEl,HEIGHT,newSize);newSize=(parseInt(Dom.getStyle(maskEl,WIDTH),10)-
parseInt(Dom.getStyle(tlEl,WIDTH),10))+'px';Dom.setStyle(trEl,WIDTH,newSize);Dom.setStyle(brEl,WIDTH,newSize);},_recalculateConstants:function(){YAHOO.log('Recalculating auxiliary factors','info','ProgressBar');var barEl=this.get(BAR_EL);switch(this.get(DIRECTION)){case DIRECTION_LTR:case DIRECTION_RTL:this._barSpace=parseInt(this.get(WIDTH),10)-
(parseInt(Dom.getStyle(barEl,'marginLeft'),10)||0)-
(parseInt(Dom.getStyle(barEl,'marginRight'),10)||0);break;case DIRECTION_TTB:case DIRECTION_BTT:this._barSpace=parseInt(this.get(HEIGHT),10)-
(parseInt(Dom.getStyle(barEl,'marginTop'),10)||0)-
(parseInt(Dom.getStyle(barEl,'marginBottom'),10)||0);break;}
this._barFactor=this._barSpace/(this.get(MAX_VALUE)-(this.get(MIN_VALUE)||0))||1;},_animSetter:function(value){var anim,barEl=this.get(BAR_EL);if(value){YAHOO.log('Turning animation on','info','ProgressBar');if(value instanceof YAHOO.util.Anim){anim=value;}else{anim=new YAHOO.util.Anim(barEl);}
anim.onTween.subscribe(this._animOnTween,this,true);anim.onComplete.subscribe(this._animComplete,this,true);var oldSetAttribute=anim.setAttribute,pb=this;switch(this.get(DIRECTION)){case DIRECTION_BTT:anim.setAttribute=function(attr,val,unit){val=Math.round(val);oldSetAttribute.call(this,attr,val,unit);Dom.setStyle(barEl,'top',(pb._barSpace-val)+'px');};break;case DIRECTION_RTL:anim.setAttribute=function(attr,val,unit){val=Math.round(val);oldSetAttribute.call(this,attr,val,unit);Dom.setStyle(barEl,'left',(pb._barSpace-val)+'px');};break;}}else{YAHOO.log('Turning animation off','info','ProgressBar');anim=this.get(ANIM);if(anim){anim.onTween.unsubscribeAll();anim.onComplete.unsubscribeAll();}
anim=null;}
this._barSizeFunction=this._barSizeFunctions[anim?1:0][this.get(DIRECTION)];return anim;},_animComplete:function(){YAHOO.log('Animation completed','info','ProgressBar');var value=this.get(VALUE);this._previousValue=value;this.fireEvent(PROGRESS,value);this.fireEvent(COMPLETE,value);Dom.removeClass(this.get(BAR_EL),CLASS_ANIM);},_animOnTween:function(name,oArgs){var value=Math.floor(this._tweenFactor*oArgs[0].currentFrame+this._previousValue);this.fireEvent(PROGRESS,value);},_valueChange:function(value){YAHOO.log('set value: '+value,'info','ProgressBar');var anim=this.get(ANIM),pixelValue=Math.floor((value-this.get(MIN_VALUE))*this._barFactor),barEl=this.get(BAR_EL);this._setAriaText(value);if(this._rendered){if(anim){anim.stop();if(anim.isAnimated()){anim._onComplete.fire();}}
this.fireEvent(START,this._previousValue);this._barSizeFunction(value,pixelValue,barEl,anim);}},_setAriaText:function(value){var container=this.get('element'),text=Lang.substitute(this.get(ARIA_TEXT_TEMPLATE),{value:value,minValue:this.get(MIN_VALUE),maxValue:this.get(MAX_VALUE)});container.setAttribute('aria-valuenow',value);container.setAttribute('aria-valuetext',text);}});var b=[{},{}];Prog.prototype._barSizeFunctions=b;b[0][DIRECTION_LTR]=function(value,pixelValue,barEl,anim){Dom.setStyle(barEl,WIDTH,pixelValue+'px');this.fireEvent(PROGRESS,value);this.fireEvent(COMPLETE,value);};b[0][DIRECTION_RTL]=function(value,pixelValue,barEl,anim){Dom.setStyle(barEl,WIDTH,pixelValue+'px');Dom.setStyle(barEl,'left',(this._barSpace-pixelValue)+'px');this.fireEvent(PROGRESS,value);this.fireEvent(COMPLETE,value);};b[0][DIRECTION_TTB]=function(value,pixelValue,barEl,anim){Dom.setStyle(barEl,HEIGHT,pixelValue+'px');this.fireEvent(PROGRESS,value);this.fireEvent(COMPLETE,value);};b[0][DIRECTION_BTT]=function(value,pixelValue,barEl,anim){Dom.setStyle(barEl,HEIGHT,pixelValue+'px');Dom.setStyle(barEl,'top',(this._barSpace-pixelValue)+'px');this.fireEvent(PROGRESS,value);this.fireEvent(COMPLETE,value);};b[1][DIRECTION_LTR]=function(value,pixelValue,barEl,anim){Dom.addClass(barEl,CLASS_ANIM);this._tweenFactor=(value-this._previousValue)/anim.totalFrames/anim.duration;anim.attributes={width:{to:pixelValue}};anim.animate();};b[1][DIRECTION_RTL]=b[1][DIRECTION_LTR];b[1][DIRECTION_TTB]=function(value,pixelValue,barEl,anim){Dom.addClass(barEl,CLASS_ANIM);this._tweenFactor=(value-this._previousValue)/anim.totalFrames/anim.duration;anim.attributes={height:{to:pixelValue}};anim.animate();};b[1][DIRECTION_BTT]=b[1][DIRECTION_TTB];})();YAHOO.register("progressbar",YAHOO.widget.ProgressBar,{version:"2.8.0r4",build:"2449"});