<?xml version="1.0" encoding="UTF-8"?>
<project name="patch" default="build">
	<property name="nsis.dir" value="C:\Program Files (x86)\NSIS" />
	<property name="svnant.dir" value="..\..\trunk\lib\ant" />
	
	<!-- SVN task definition -->
	<typedef resource="org/tigris/subversion/svnant/svnantlib.xml">
		<classpath>
			<fileset dir="${svnant.dir}">
				<include name="*.jar" />
			</fileset>
		</classpath>
	</typedef>

	<target name="build">
		<!-- Get revision info from svn -->
		<svn svnkit="true" javahl="false" username="cruisecontrol@terraframe.com" password="Mr.Sparkle">
			<info target="../" verbose="true" propPrefix="svn.info." />
		</svn>

		<!-- Write revision info into manager.nsi -->
		<replaceregexp match="StrCpy \$Version \d*" replace="StrCpy $Version ${svn.info.lastRev}" file="manager.nsi" byline="true" />

		<!-- Compile patch.nsi -->
		<exec executable="${nsis.dir}/makensis" dir="." failonerror="true" searchpath="true" logError="true">
			<arg line="manager.nsi" />
		</exec>
	</target>
</project>
