<?xml version="1.0" encoding="UTF-8"?>
<project name="geo-manager" default="deploy">

	<!-- =================================================================== -->
	<!-- Set up our properties                                               -->
	<!-- =================================================================== -->

	<!-- IMPORTANT: This ant script should be run with a base directory set to the root of the project! -->
	  
	  <!-- Launch Properties: -->
	  <!-- mdss.root, mdss.admin, swt.jar -->
	  <!-- (Set these in the launch configuration) -->
	
	<property name="mdss.root" value="/Users/terraframe/Documents/workspace2/mdss root/trunk" />
	<property name="swt.jar" value="/Users/terraframe/.m2/repository/org/eclipse/swt-macosx64/4.3/swt-macosx64-4.3.jar" />
	
	<property name="profile.root" value="${mdss.root}/profiles" />
	<property name="system.password" value="mdsstest2" />
	<taskdef name="runwayproperties" classname="com.runwaysdk.ant.RunwayProperties" classpath="${profile.root};${mdss.root}/scripts/ant/deploy/runwayProperties.jar" />
	<runwayproperties root="${profile.root}" />
	<echo message="${java.ext.dirs}" />

	<!-- Add in AspectJ task definitions -->
	<taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties">
		<classpath>
			<fileset dir="${local.lib}">
				<include name="**/*.jar" />
			</fileset>
		</classpath>
	</taskdef>


	<!-- execution path -->
	<path id="framework.classpath">
		<fileset dir="${local.lib}">
			<include name="**/*.jar" />
		</fileset>
		<pathelement location="${profile.root}" />
		<pathelement path="${java.home}/lib/ext/sunjce_provider.jar" />
		<pathelement path="${swt.jar}" />
		<pathelement location="${local.bin}" />
		<pathelement location="${client.bin}" />
		<pathelement location="${server.bin}" />
		<pathelement location="${common.bin}" />
	</path>

	<property name="gis.version" value="1.0.0" />
	<property name="gis.root" value="${basedir}" />

	<property name="gis.lib" value="${gis.root}/lib/" />
	<property name="gis.java" value="${gis.root}/src/main/java" />
	<property name="gis.resources" value="${gis.root}/src/main/resources" />

	<property name="target.dir" value="${gis.root}/target" />
	<property name="deploy.dir" value="${mdss.admin}/geo-manager-${gis.version}" />

	<path id="gis.classpath">
		<fileset dir="${gis.lib}">
			<include name="**/*" />
		</fileset>
	</path>

	<target name="clean">
	  <delete dir="${target.dir}" failonerror="false"/>
	</target>
	
	<target name="compile" depends="clean">
		<mkdir dir="${target.dir}" />
		<mkdir dir="${target.dir}/classes" />

		<iajc destdir="${target.dir}/classes" sourceroots="${gis.java}" debug="true" source="1.8" target="1.8" maxmem="1024m">
			<aspectpath>
				<pathelement location="${server.lib}/runwaysdk-server.jar" />
				<pathelement location="${common.lib}/runwaysdk-common.jar" />
				<pathelement location="${client.lib}/runwaysdk-client.jar" />
			</aspectpath>

			<classpath>
				<path refid="framework.classpath" />
				<path refid="gis.classpath" />
				<pathelement location="${common.bin}" />
			</classpath>
		</iajc>

		<!-- Copy the resources dir -->
		<copy todir="${target.dir}/classes" overwrite="true">
			<fileset dir="${gis.resources}">
				<exclude name="**/*.properties" />
				<include name="**/*" />
			</fileset>
		</copy>
	</target>


	<target name="test" depends="compile">
	</target>

	<target name="package" depends="test">
		<jar destfile="${target.dir}/geo-manager-${gis.version}.jar" compress="true">
			<fileset dir="${target.dir}/classes">
				<include name="**/*" />
			</fileset>
		</jar>
	</target>

	<target name="deploy" depends="package">
		<mkdir dir="${deploy.dir}" />

		<copy todir="${deploy.dir}/lib" overwrite="true">
			<fileset dir="${gis.lib}">
				<include name="**/*" />
			</fileset>
			<fileset dir="${target.dir}">
				<include name="**/geo-manager-${gis.version}.jar" />
			</fileset>
		</copy>
		
		<copy todir="${deploy.dir}/classes" overwrite="true">
			<fileset dir="${gis.resources}">
				<include name="**/*.properties" />
			</fileset>
		</copy>
	</target>
</project>