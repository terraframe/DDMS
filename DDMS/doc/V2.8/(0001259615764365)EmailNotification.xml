<!--
  Copyright (C) 2018 IVCC
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<version
  xsi:noNamespaceSchemaLocation="../../profiles/version_gis.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <doIt>
    <create>
      <enumerationMaster
        name="dss.vector.solutions.general.EmailProtocolMaster"
        label="Email Authentication Method"
        generateController="false" />

      <object
        key="SMTP"
        type="dss.vector.solutions.general.EmailProtocolMaster">
        <attribute
          name="enumName"
          value="SMTP" />
        <attributeStruct
          name="displayLabel">
          <attribute
            name="defaultLocale"
            value="SMTP" />
        </attributeStruct>
      </object>
      <object
        key="SMTP_TLS"
        type="dss.vector.solutions.general.EmailProtocolMaster">
        <attribute
          name="enumName"
          value="SMTP_TLS" />
        <attributeStruct
          name="displayLabel">
          <attribute
            name="defaultLocale"
            value="SMTP with TLS" />
        </attributeStruct>
      </object>
      <object
        key="SMTPS"
        type="dss.vector.solutions.general.EmailProtocolMaster">
        <attribute
          name="enumName"
          value="SMTPS" />
        <attributeStruct
          name="displayLabel">
          <attribute
            name="defaultLocale"
            value="SMTPS" />
        </attributeStruct>
      </object>

      <mdEnumeration
        name="dss.vector.solutions.general.EmailProtocol"
        type="dss.vector.solutions.general.EmailProtocolMaster">
        <includeAll />
      </mdEnumeration>

      <mdBusiness
        name="dss.vector.solutions.general.Email"
        label="Email"
        generateController="true">
        <attributes>
          <text
            size=""
            name="toAddresses"
            label="To" />
          <text
            name="ccAddresses"
            label="Cc" />
          <text
            name="bccAddresses"
            label="Bcc" />
          <char
            name="fromAddress"
            label="From"
            size="256" />
          <char
            name="subject"
            label="Subject"
            size="256" />
          <text
            name="body"
            label="Body" />
          <dateTime
            name="sentDate"
            label="Date Sent" />
          <text
            name="error"
            label="Error" />
        </attributes>
      </mdBusiness>

      <mdBusiness
        name="dss.vector.solutions.general.EmailConfiguration"
        label="Email Configuration"
        generateController="true">
        <attributes>
          <char
            name="emailServer"
            label="Host (server) name"
            size="256" />
          <enumeration
            name="protocol"
            label="Email protocol"
            type="dss.vector.solutions.general.EmailProtocol"
            selectMultiple="false"
            required="true" />
          <char
            name="emailUserid"
            label="Userid"
            size="256" />
          <char
            name="emailPassword"
            label="Password"
            size="256" />
          <integer
            name="retry"
            label="Retry frequency"
            description="Retry frequency (minutes)"
            rejectNegative="true"
            rejectZero="true" />
          <integer
            name="timeout"
            label="Timeout period"
            description="Timeout period (days)"
            rejectNegative="true"
            rejectZero="true" />
        </attributes>
      </mdBusiness>

      <object
        type="dss.vector.solutions.general.EmailConfiguration"
        key="default">
        <attribute
          name="emailServer"
          value="smtp.gmail.com" />
        <attributeEnumeration
          name="protocol">
          <enumeratedItem
            name="SMTPS" />
        </attributeEnumeration>
        <attribute
          name="emailUserid"
          value="mdsstest@gmail.com" />
        <attribute
          name="emailPassword"
          value="BobbyTables" />
        <attribute
          name="retry"
          value="60" />
        <attribute
          name="timeout"
          value="3" />
      </object>

      <mdBusiness
        name="dss.vector.solutions.general.SystemAlert"
        label="Email"
        generateController="true">
        <attributes>
          <boolean
            name="isOnscreenActive"
            label="Is Onscreen Active"
            positiveLabel="Active"
            negativeLabel="Inactive"
            required="true"
            defaultValue="true" />
          <boolean
            name="isEmailActive"
            label="Is Email Active"
            positiveLabel="Active"
            negativeLabel="Inactive"
            required="true"
            defaultValue="true" />
          <text
            name="emailToAddresses"
            label="To" />
          <text
            name="emailCcAddresses"
            label="Cc" />
          <text
            name="emailBccAddresses"
            label="Bcc" />
          <char
            name="emailFromAddress"
            label="From"
            size="256" />
          <char
            name="emailSubject"
            label="Subject"
            size="256" />
          <text
            name="emailBody"
            label="Body" />
          <localText
            name="emailTemplateVariables"
            label="Template Variables" />
        </attributes>
      </mdBusiness>

      <object
        type="dss.vector.solutions.general.SystemAlert"
        key="Notification">
        <attribute
          name="isOnscreenActive"
          value="true" />
        <attribute
          name="isEmailActive"
          value="true" />
        <attribute
          name="emailToAddresses"
          value="mdsstest@gmail.com" />
        <attribute
          name="emailFromAddress"
          value="mdsstest@gmail.com" />
        <attribute
          name="emailSubject"
          value="Test Email ($thresholdType)" />
        <attribute
          name="emailBody"
          value="Notification email:  $thresholdType of $alertType at [$entityLabel].  Total Cases: [$totalCases], Threshold: [$threshold]" />
        <attributeStruct
          name="emailTemplateVariables">
          <attribute
            name="defaultLocale"
            value="thresholdType, alertType, entityLabel, totalCases, threshold" />
        </attributeStruct>
      </object>

      <object
        type="dss.vector.solutions.general.SystemAlert"
        key="Identification">
        <attribute
          name="isOnscreenActive"
          value="true" />
        <attribute
          name="isEmailActive"
          value="true" />
        <attribute
          name="emailToAddresses"
          value="mdsstest@gmail.com" />
        <attribute
          name="emailFromAddress"
          value="mdsstest@gmail.com" />
        <attribute
          name="emailSubject"
          value="Test Email ($thresholdType)" />
        <attribute
          name="emailBody"
          value="Identification email:  $thresholdType of $alertType at [$entityLabel].  Total Cases: [$totalCases], Threshold: [$threshold]" />
        <attributeStruct
          name="emailTemplateVariables">
          <attribute
            name="defaultLocale"
            value="thresholdType, alertType, entityLabel, totalCases, threshold" />
        </attributeStruct>
      </object>
    </create>

  </doIt>
  <undoIt>
    <delete>
      <object
        key="dss.vector.solutions.general.EmailConfiguration"
        type="com.runwaysdk.system.metadata.MdBusiness" />
      <object
        key="dss.vector.solutions.general.SystemAlertEmailTemplateVariables"
        type="com.runwaysdk.system.metadata.MdBusiness" />
      <object
        key="dss.vector.solutions.general.SystemAlert"
        type="com.runwaysdk.system.metadata.MdBusiness" />
      <object
        key="dss.vector.solutions.general.EmailProtocol"
        type="com.runwaysdk.system.metadata.MdEnumeration" />
      <object
        key="dss.vector.solutions.general.EmailProtocolMaster"
        type="com.runwaysdk.system.metadata.MdBusiness" />
      <object
        key="dss.vector.solutions.general.Email"
        type="com.runwaysdk.system.metadata.MdBusiness" />
    </delete>
  </undoIt>
</version>
