<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright (C) 2018 IVCC
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<project name="patch" default="build">
	<property name="nsis.dir" value="C:\Program Files (x86)\NSIS" />
	<property name="svnant.dir" value="..\..\trunk\lib\ant" />
	
	<!-- SVN task definition -->
	<typedef resource="org/tigris/subversion/svnant/svnantlib.xml">
		<classpath>
			<fileset dir="${svnant.dir}">
				<include name="*.jar" />
			</fileset>
		</classpath>
	</typedef>

	<target name="build">
		<!-- Get revision info from svn -->
		<svn svnkit="true" javahl="false" username="cruisecontrol@terraframe.com" password="Mr.Sparkle">
			<info target="../" verbose="true" propPrefix="svn.info." />
		</svn>

		<!-- Write revision info into manager.nsi -->
		<replaceregexp match="StrCpy \$Version \d*" replace="StrCpy $Version ${svn.info.lastRev}" file="manager.nsi" byline="true" />

		<!-- Compile patch.nsi -->
		<exec executable="${nsis.dir}/makensis" dir="." failonerror="true" searchpath="true" logError="true">
			<arg line="manager.nsi" />
		</exec>
	</target>
</project>
