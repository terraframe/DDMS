<?xml version="1.0" encoding="UTF-8"?>
<project name="geo-manager" default="deploy">

	<!-- =================================================================== -->
	<!-- Set up our properties                                               -->
	<!-- =================================================================== -->

	<property name="profile.root" value="/home/jsmethie/workspace/Runway/trunk/profiles/" />
	<property name="system.password" value="mdsstest2" />
	<taskdef name="runwayproperties" classname="com.runwaysdk.ant.RunwayProperties" classpath="${profile.root};/home/jsmethie/workspace/Runway/trunk/scripts/ant/runwayProperties.jar" />
	<runwayproperties root="${profile.root}" />
	<echo message="${java.ext.dirs}" />

	<!-- Add in AspectJ task definitions -->
	<taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties">
		<classpath>
			<fileset dir="${local.lib}">
				<include name="**/*.jar" />
			</fileset>
		</classpath>
	</taskdef>


	<!-- execution path -->
	<path id="framework.classpath">
		<fileset dir="${runway.lib}">
			<exclude name="**/runwaysdk.jar" />
			<include name="**/*.jar" />
		</fileset>
		<pathelement location="${runway.bin}" />
		<pathelement location="${profile.root}" />
		<pathelement path="${java.home}/lib/ext/sunjce_provider.jar" />
		<pathelement path="/home/jsmethie/workspace/org.eclipse.swt/swt.jar" />
	</path>

	<property name="manager.version" value="1.0.0" />
	<property name="manager.root" value="/home/jsmethie/workspace/backup-manager" />

	<property name="manager.lib" value="${manager.root}/lib/" />
	<property name="manager.java" value="${manager.root}/src/main/java" />
	<property name="manager.resources" value="${manager.root}/src/main/resources" />

	<property name="target.dir" value="${manager.root}/target" />
	<property name="deploy.dir" value="/home/jsmethie/workspace/MDSSAdmin/backup-manager-${manager.version}" />

	<path id="manager.classpath">
		<fileset dir="${manager.lib}">
			<include name="**/*" />
		</fileset>
	</path>

	<target name="compile">
		<mkdir dir="${target.dir}" />
		<mkdir dir="${target.dir}/classes" />

		<iajc destdir="${target.dir}/classes" sourceroots="${manager.java}" debug="true" source="1.6" target="1.6" maxmem="1024m">
			<aspectpath>
				<path refid="framework.classpath" />
			</aspectpath>
			<classpath>
				<path refid="framework.classpath" />
				<path refid="manager.classpath" />
			</classpath>
		</iajc>

		<!-- Copy the resources dir -->
		<copy todir="${target.dir}/classes" overwrite="true">
			<fileset dir="${manager.resources}">
				<include name="**/*.png" />
			</fileset>
		</copy>
	</target>


	<target name="test" depends="compile">
	</target>

	<target name="package" depends="test">
		<jar destfile="${target.dir}/backup-manager-${manager.version}.jar" compress="true">
			<fileset dir="${target.dir}/classes">
				<exclude name="**/*.properties"/>
				<include name="**/*" />
			</fileset>
		</jar>
	</target>

	<target name="deploy" depends="package">
		<mkdir dir="${deploy.dir}" />

		<copy todir="${deploy.dir}/lib" overwrite="true">
			<fileset dir="${manager.lib}">
				<include name="**/*" />
			</fileset>
			<fileset dir="${target.dir}">
				<include name="**/backup-manager-${manager.version}.jar" />
			</fileset>
		</copy>
		
		<copy todir="${deploy.dir}/classes" overwrite="true">
			<fileset dir="${manager.resources}">
				<include name="**/*.properties" />
			</fileset>
		</copy>
	</target>
</project>